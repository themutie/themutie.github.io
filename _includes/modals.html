<!-- Portfolio Modals -->
{% for post in site.posts %}
<div class="portfolio-modal modal fade" id="portfolioModal-{{ post.modal-id }}" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-content">
    <div class="close-modal" data-dismiss="modal">
      <div class="lr">
        <div class="rl"></div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2">
          <div class="modal-body">
            <h2>{{ post.title }}</h2>
            <hr class="star-primary">
            <img src="img/portfolio/{{ post.img }}" class="img-responsive img-centered" alt="{{ post.alt }}">
            
            {% if post.description %}
            <p>{{ post.description }}</p>
            {% endif %}
            
            <ul class="list-inline item-details">
              {% if post.client %}
              <li>Client: <strong>{{ post.client }}</strong></li>
              {% endif %}
              {% if post.project-date %}
              <li>Date: <strong>{{ post.project-date }}</strong></li>
              {% endif %}
              {% if post.category %}
              <li>Service: <strong>{{ post.category }}</strong></li>
              {% endif %}
            </ul>
            
            <br>
            
            {% if post.tracks %}
            <ol class="track-list">
              {% for track in post.tracks %}
              <li class="track-item">
                <span class="track-number">{{ forloop.index }}.</span>
                <span class="track-title">{{ track.track.name }}</span>
                <!-- Add unique ID for each audio element -->
                <audio class="track-player" controls id="track-{{ forloop.index }}" src="{{ track.track.path }}">
                  <a href="{{ track.track.path }}">Download audio</a>
                </audio>
              </li>
              {% endfor %}
            </ol>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endfor %}
<script>
  // Track the currently playing audio element
  let currentAudio = null;

  // Get all audio elements with the class 'track'
  const audioElements = document.querySelectorAll('audio.track');

  // Add event listeners for each audio element
  audioElements.forEach((audio, index) => {
    // Handle play events
    audio.addEventListener('play', function () {
      // If another audio is playing, pause it and reset its time
      if (currentAudio && currentAudio !== audio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
      }
      // Update currentAudio to the newly playing one
      currentAudio = audio;
    });

    // Handle ended event to move to the next track
    audio.addEventListener('ended', function () {
      const nextIndex = index + 1; // Find the next track index
      if (nextIndex < audioElements.length) {
        const nextAudio = audioElements[nextIndex];
        nextAudio.play(); // Play the next track
      } else {
        // Reset to the first track if it's the last one
        audioElements[0].play();
      }
    });
  });
</script>

<!-- CSS for styling the track row -->
<style>
  .track-list {
    padding: 0;
    list-style-type: none;
  }

  .track-item {
    display: flex;
    align-items: center;
    margin-bottom: 1rem;
  }

  .track-number {
    width: 2rem;
    font-weight: bold;
    text-align: right;
    margin-right: 1rem;
  }

  .track-title {
    flex-grow: 1;
    margin-right: 1rem;
    font-size: 2rem;
  }

  .track-player {
    flex-shrink: 0;
  }
</style>
